<app-navbar></app-navbar>

<div class="container mt-5" *ngIf="solicitacao">
  <h2 class="mb-4">Visualizar Solicitação</h2>

  <div class="card mb-4">
    <div class="card-body">
      <p><strong>Data/Hora:</strong> {{ solicitacao.dataHora | date:'dd/MM/yyyy HH:mm' }}</p>
      <p><strong>Equipamento:</strong> {{ solicitacao.descricaoEquipamento }}</p>
      <p><strong>Categoria:</strong> {{ solicitacao.categoriaEquipamento }}</p>
      <p><strong>Defeito:</strong> {{ solicitacao.descricaoDefeito }}</p>
      <p *ngIf="solicitacao.valorOrcamento > 0">
        <strong>Orçamento:</strong> {{ solicitacao.valorOrcamento | currency:'BRL':'symbol' }}
      </p>
      <p *ngIf="solicitacao.idFuncionario">
        <strong>Funcionário:</strong> {{ nomeFuncionario }}
      </p>
    </div>
  </div>

  <h4 class="mb-3">Histórico de Atualizações</h4>
  <ul class="list-group mb-4">
    <li class="list-group-item" *ngFor="let h of historico">
      {{ h.dataHora | date:'dd/MM/yyyy HH:mm' }} –
      <span
        class="badge"
        [ngClass]="{
          'bg-secondary': h.estado === 'Aberta',
          'bg-info':      h.estado === 'Orcada',
          'bg-warning':   h.estado === 'Aprovada',
          'bg-danger':    h.estado === 'Rejeitada',
          'bg-dark':      h.estado === 'Removida',
          'bg-primary':   h.estado === 'Arrumada',
          'bg-success':   h.estado === 'Finalizada',
          'bg-success text-dark': h.estado === 'Paga'
        }"
      >
        {{ h.estado }}
      </span>
      <div *ngIf="h.funcionarioId" class="ms-2 text-muted">
        (por {{ h.funcionarioId }})
      </div>
      <div *ngIf="h.observacao" class="mt-1"><em>{{ h.observacao }}</em></div>
    </li>
  </ul>

  <div class="d-flex gap-2">
    <button
      *ngIf="solicitacao.estado === 'Orcada'"
      class="btn btn-primary"
      [routerLink]="['/mostrar-orcamento', solicitacao.dataHora]">
      Ver Orçamento
    </button>

    <button
      *ngIf="solicitacao.estado === 'Rejeitada'"
      class="btn btn-warning"
      (click)="resgatar()">
      Resgatar Serviço
    </button>

    <button
      *ngIf="solicitacao.estado === 'Arrumada'"
      class="btn btn-success"
      [routerLink]="['/pagarservico', solicitacao.dataHora]">
      Pagar Serviço
    </button>

    <button
      class="btn btn-secondary"
      [routerLink]="['/paginainicialcliente']">
      Voltar
    </button>
  </div>
</div>
